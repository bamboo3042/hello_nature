<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>매거진 관리 | 레시피 등록</title>
    <link rel="stylesheet" href="/admin/css/style2.css">
    <link rel="stylesheet" href="/admin/css/style.css">
    <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/admin/ckeditor/ckeditor.js"></script>
    <script src="/admin/js/Admin.imeage.js"></script>
</head>
<body>
<script>
    function tableCreate(){
        let tc = new Array();
        let html = '';
                    
        let recipe = $("#recipe").val();
        let gram = $("#gram").val();
                    
        html += '<tr>';
        html += '<td class=ingredient>'+recipe+'</td>';
        html += '<td class="gram">'+gram+'</td>';
        html += '</tr>';
        $("#dynamicTable").append(html);
                    
        $("#recipe").val('');
        $("#gram").val('');
    }

    function deleteRow(rownum) {
        const table = document.getElementById('dynamicTbody');
        const newRow = table.deleteRow(rownum);
    }

    function sendit(){

        let title = $('#title').val()
        let des = $('#des').val()
        let cookTime = $('#cookTime').val() + "분";
        let cookKcal = $('#cookKcal').val()
        let cookLevel = $('#cookLevel').val()
        let content = CKEDITOR.instances.textarea.getData();
        let prodidxs = document.querySelectorAll(".prodidxs")
        let prodidx = prodidxs.value
        let type = $("#recipe_type_hidden").val()

        let ingredient = document.querySelectorAll(".ingredient")
        let gram = document.querySelectorAll(".gram")

        let ingredients =[];
        let grams = [];

        $(ingredient).each(function (e){
            ingredients.push($(this).text())
        })

        $(gram).each(function (e){
            grams.push($(this).text())
        })

        let row =[];
        for(let i=0; i < ingredients.length ; i++){
            for(let j=0; j < grams.length; j++){
                row.push(ingredients[i] + "-" + grams[i]);
                row = Array.from(new Set(row));
            }
        }

        console.log(row)

        axios.post("/api/magazine/create/", {
            data:{
                type : "RECIPE",
                title : title,
                des : des,
                cookTime : cookTime,
                cookKcal : cookKcal,
                cookLevel : cookLevel,
                cookIngredient : String(row),
                img : "uploads/file",
                content : content,
                showFlag : 1,
                // prodidx: "레시피예시"
            }
        }).then(function (){
            alert("레시피 등록에 성공했습니다")
            $.ajax({
                type:"GET",
                url : "admin/Admin_RecipeCreate.html",
                datatype : "html/text",
                success: function(result){
                    $("#content").html(result).trigger("create");
                }
            });
        })
    }

    function sendpd(){

        let tr=[];
        $("input:checkbox[name='RC_list']:checked").each(function(e) {
            tr.push(this.parentNode.parentNode);
        })
        console.log(tr)

        for(let i in tr){
            let $id = $(tr[i]).children().eq(0).children().val()
            let $img = $(tr[i]).children().eq(1).children().attr("src")
            let $title = $(tr[i]).children().eq(2).text();
            console.log($img)
            console.log($title)

            let row = $('<div>').append(
                '<input type="hidden" value="'+$id+'" class="RC_hidden">' +
                '<img src="'+$img+'">' +
                '<p>'+$title+'</p></div>'
            )
            $('.RC_proBox').append(row)
        }
    }

    $(function () {
        axios.get("/api/category/list/first", {}).then(function (response) {
            for (let i in response.data.data) {
                let $id = response.data.data[i].idx;
                let $name = response.data.data[i].name;
                let row = $('<option value='+$id+'>').append(
                    $name + '</option>'
                )
                console.log(row)
                $('#Pl_sel_1').append(row)
            }
        })
    })

    function categoryChange(e){
        axios.get("/api/category/list/second/" + e.value, {}).then(function (response) {
            for (let i in response.data.data) {
                console.log(response)
                let $id = response.data.data[i].idx;
                let $name = response.data.data[i].name;

                let row = $('<option value=' + $id + '>').append(
                    $name + '</option>'
                )
                console.log(row)
                $('#PL_sel_2').append(row)
            }
        })
    }

    function sendsc(){

        let cateIdx =
        axios.get("/api/product/magazineProduct?cateIdx=?&state=?&order=?&proName=?&page=?&idxList=?&nameList=?&imgList=?",{}).then(function (){
        })
    }

</script>
    <!--content_title 시작-->
    <div class="content_title"><p>매거진 관리<span>레시피 등록</span></p></div>
    <!--content_title 끝-->
    <!--RCreate 시작-->
    <div class="RCreate">
        <!--form 시작-->
        <form class="RC_form">
            <div class="RC_c1">
                <p class="product_title" id="RC_c1_title"><label>레시피 등록</label></p>
                <table class="RC_table">
                    <tr>
                        <th>이미지</th>
                        <td>
                            <div id="RC_imgbox">
                                <img src=" " id="RC_img">
                                <!--등록 이미지 들어가는 곳-->
                                <div class="RC_Btnbox">
                                    <div class="file_input_div_t">
                                        <input type="button" value="파일 등록" class="file_input_button_t">
                                        <input type="file" class="file_input_hidden_t" id="RC_imgbtn">
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th width="200px">제목</th>
                        <td colspan="3"><input type="text" name="text" placeholder="제목을 입력하세요" id="title"></td>
                    </tr>
                    <tr>
                        <th>설명</th>
                        <td colspan="3"><input type="text" name="text" placeholder="레시피 한줄 설명을 기재하세요" id="des"></td>
                    </tr>
                    <tr>
                        <th>요리시간</th>
                        <td colspan="3"><input type="text" style="width: 300px;" id="cookTime">분</td>
                    </tr>
                    <tr>
                        <th>열량(Kcal)</th>
                        <td colspan="3" class="kcal"><input type="text" style="width: 300px;" id="cookKcal">Kcal</td>
                    </tr>
                    <tr>
                        <th>난이도</th>
                        <td colspan="3">
                            <select id="cookLevel">
                                <option value="">선택</option>
                                <option value=1>초급</option>
                                <option value=2>중급</option>
                                <option value=3>고급</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>재료</th>
                        <td class="recipe_text">
                            <div class="recipe_add">
                                <input type="text" placeholder="재료명" id="recipe"><input type="text" placeholder="용량/단위" id="gram"> 
                                <input type="button" onclick="tableCreate()" value="재료추가"
                                style="width: 100px; height: 38px;">
                                <input type="button" onclick="deleteRow(-1)" value="재료삭제" style="height: 38px; width: 85px; font-weight: bold;">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th></th>
                        <td class="recipe_table">
                            <div class="recipe_text">
                                <table id="dynamicTable">
                                    <thead>
                                        <tr>
                                            <th width="200">재료</th>
                                            <th width="200">용량/단위</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dynamicTbody">       
                                    </tbody>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="RC_c2">
                <div class="RC_c3_editlist">
                    <p>만드는 법</p>
                    <div class='RC_c3_htmllist'>
                        <div class='create_html'><span>HTML</span></div>
                        <textarea class='textarea' name='textarea'></textarea>
                    </div>
                    <script type="text/javascript">
                        CKEDITOR.replace('textarea'
                                    , {height: 300                                                 
                                });
                    </script>
                    <div class='RC_prodlist'>
                        <div class='create_prod'><span>상품</span></div>
                        <div class='RC_prodTitle'><p>상품 목록</p></div>
                        <div class='RC_proBox'></div>
                        <!-- pageBox 시작-->
                        <div class="pageBox">
                            <ul>
                                <li id="Maxprev"><a href="#"><<</a></li>
                                <li><a href="#"><</a></li>
                                <li><a href="#">1</a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">></a></li>
                                <li id="Maxnext"><a href="#">>></a></li>
                            </ul>
                        </div>
                        <!-- pageBox 끝-->
                        <div class='RC_addTitle'>
                            <p>상품추가<span> + 원하는 상품을 추가해주세요</span></p>
                        </div>
                        <form class='RC_addlist'>
                            <table border="1px" class='RC_scbox'>
                                <tr height="70">
                                    <th width="150">상품분류</th>
                                    <td>
                                        <select onchange="categoryChange(this)" id="PL_sel_1">
                                            <option value="대분류">대분류</option>
                                        </select>
                                        <select id="PL_sel_2">
                                            <option value="중분류">중분류</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr height="70">
                                    <th>판매상태</th>
                                    <td>
                                        <input type="checkbox" name="d_status2" value="0" id="RC_check_1"><label for="RC_check_1">전체</label>
                                        <label><input type="checkbox" name="d_status2" value="1" id="RC_check_2"><label for="RC_check_2">정상판매</label>
                                        <label><input type="checkbox" name="d_status2" value="2" id="RC_check_3"><label for="RC_check_3">판매중지</label>
                                        <label><input type="checkbox" name="d_status2" value="3" id="RC_check_4"><label for="RC_check_4">품절</label>
                                    </td>
                                </tr>
                                <tr height="70">
                                    <th>정렬</th>
                                    <td>
                                    <input type="checkbox" id="RC_check_5"><label for="RC_check_5">최근등록순</label>
                                    <input type="checkbox" id="RC_check_6"><label for="RC_check_6">등록오랜순</label>
                                    <input type="checkbox" id="RC_check_7"><label for="RC_check_7">높은가격순</label>
                                    <input type="checkbox" id="RC_check_8"><label for="RC_check_8">낮은가격순</label>
                                    </td>
                                </tr>
                                <tr height="70">
                                    <th>상품명</th>
                                    <td>
                                        <input type="text" placeholder="상품명을 입력해주세요" id="RC_scName">
                                        <input type="submit" value="검색" id="RC_scbtn">
                                    </td>
                                </tr>
                            </table>
                            <div class="bottom_btn" id="RC_btnBox">
                                <span><input type="button" name="button" value="추가" onclick="sendpd()"></span>
                            </div>
                            <table width="100%" style="text-align: center;" class="RC_p_list">
                                <tr>
                                    <th width="7%" height="40px"><input type="checkbox" value="cou_list" id="RC_check_9" name="RC_list"><label for="RC_check_9"></label></th>
                                    <th width="40%">상품 이미지</th>
                                    <th width="28%">상품명</th>
                                    <th width="25%">카테고리</th>
                                </tr>
                                <tr>
                                    <td height="80px"><input type="checkbox" value="cou_list" id="RC_check_10" name="RC_list"><label for="RC_check_10"></label></td>
                                    <td><img src="">예시</td>
                                    <td>예시</td>
                                    <td>예시</td>
                                </tr>
                            </table>
                            <div class="pageBox" id="RC_c2_pageBox">
                                <ul>
                                    <li id="Maxprev"><a href="#"><<</a></li>
                                    <li><a href="#"><</a></li>
                                    <li><a href="#">1</a></li>
                                    <li><a href="#">2</a></li>
                                    <li><a href="#">></a></li>
                                    <li id="Maxnext"><a href="#">>></a></li>
                                </ul>
                            </div>
                        </form>
                    </div>
                <!--PC_c1_btnBox 시작-->
                <div id="RC_c1_btnBox" class="bottom_btn">
                    <input type="button" name="submit" value="등록하기" id="submit_btn" onclick="sendit()">
                </div>
                <!--PC_c1_btnBox 끝-->
            </div>
        </form>
        <!--form 끝-->
    </div>
</div>
</body>
</html>