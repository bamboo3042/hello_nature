<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전체 상품 관리 | 주문 관리</title>
    <link rel="stylesheet" href="/admin/css/style2.css">
    <script src="/admin/js/checkbox.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous">
    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<script>
    $(function (){
        axios.get('/api/orderlist/list', {
        }).then(function (response){
            let tb = $('<tbody>');

            for(let i in response.data.data){
                let $customer = response.data.data[i].memidx.getName();
                let $memFlag = response.data.data[i].memFlag;
                let $orderInfo = response.data.data[i].orderInfo;
                let $pay = response.data.data[i].pay;
                let $date = response.data.data[i].date;
                let $orderState = response.data.data[i].orderState;
                let k = parseInt(i);

                let row = $('<tr>').append(
                    '<td><input type="checkbox"  id="OL_check_'+ k +'" name="order" onclick="OL_checkSelectAll()"><label for="OL_check_'+ k +'"></td>' +
                    '<td>' + $customer + '</td>' +
                    '<td>' + $memFlag + '</td>' +
                    '<td>' + $orderInfo + '</td>' +
                    '<td>' + $pay + '</td>' +
                    '<td>' + $date + '</td>' +
                    '<td>' + $orderState + '</td>'
                )
                tb.append(row);
            }
            tb.append('</body>');
            // tb.append('</body>').empty();
            $('.thead').after(tb);
        }).catch(function (err){
            console.log(err)
        })
    })

    $(function () {
        let now = new Date();
        let now_result = now.toISOString().substring(0, 10);

        document.getElementById("weekbtn").addEventListener("click", function () {
            let week = new Date();
            week.setDate(week.getDate() - 7);
            var week_result = week.toISOString().substring(0, 10);

            document.getElementById("date_start").value = week_result;
            document.getElementById("date_end").value = now_result;
        })

        document.getElementById("monthbtn").addEventListener("click", function () {

            let month = new Date();
            month.setMonth(month.getMonth() - 1);
            var month_result = month.toISOString().substring(0, 10);


            document.getElementById("date_start").value = month_result;
            document.getElementById("date_end").value = now_result;
        })

        document.getElementById("three_monthbtn").addEventListener("click", function () {

            let three_month = new Date();
            three_month.setMonth(three_month.getMonth() - 3);
            var three_month_result = three_month.toISOString().substring(0, 10);

            document.getElementById("date_start").value = three_month_result;
            document.getElementById("date_end").value = now_result;
        })
    })

    $(function () {
        $('#delbtn').click(function (){
            let id = [];
            ($("input:checkbox[name='order']:checked").each(function (e){
                id.push($(this).val())
            }));
            console.log(id)

            axios.delete("/api/orderlist/delete", {
                data:{
                    id: id,
                }
            }).then(function (){
                alert("선택된 주문목록 삭제 성공")
            })
        }).catch(function (err){
            console.log(err)
        })
    })

    $("#schbtn").click(function (){
        let dateStart = $("#date_start").val();
        let dateEnd = $("#date_end").val();
        let orderState = $("#order_state").val();
        let memFlag = $("#mem_flag").val();
        let orderNum = $("#order_num").val();

        axios.get('/api/orderlist/list?&dataStart=' + dateStart + '&dataEnd=' + dateEnd + '&orderState=' + orderState + '&memFlag=' + memFlag + '&orderNum=' + orderNum, {

        }).then(function (response){
            for(let i in response.data.data){
                let $customer = response.data.data[i].memidx.getName();
                let $memFlag = response.data.data[i].memFlag;
                let $orderInfo = response.data.data[i].orderInfo;
                let $pay = response.data.data[i].pay;
                let $date = response.data.data[i].date;
                let $orderState = response.data.data[i].orderState;
                let k = parseInt(i);

                let row = $('<tr>').append(
                    '<td><input type="checkbox"  id="OL_check_'+ k +'" name="order" onclick="OL_checkSelectAll()"><label for="OL_check_'+ k +'"></td>' +
                    '<td>' + $customer + '</td>' +
                    '<td>' + $memFlag + '</td>' +
                    '<td>' + $orderInfo + '</td>' +
                    '<td>' + $pay + '</td>' +
                    '<td>' + $date + '</td>' +
                    '<td>' + $orderState + '</td>'
                )
                tb.append(row);
            }
            tb.append('</tbody>');
            $('.thead').after(tb);
        }).catch(function (err){
            console.log(err);
        })
    })
</script>
<body>
<!--content_title 시작-->
<div class="content_title">
    <p>전체 상품 관리<span>주문 관리</span></p>
</div>
<!--content_title 끝-->
<!--Order_list 시작-->
<div class="Order_list">
    <!--OL_c1 시작-->
    <div class="OL_c1">
        <!--form 시작-->
        <form name="order_search">
            <p id="OL_c1_title" class="product_title"><label>주문 조회</label></p>
            <!--table 시작-->
            <table>
                <tr>
                    <th width="100">주문일자</th>
                    <td>
                        <input type="date" name="date" value="기간필터" id="date_start"> - <input type="date" name="date" value="기간필터" id="date_end">
                        <span class="datebtn">
                                <input type="button" name="button" value="최근 1주일" id="weekbtn">
                                <input type="button" name="button" value="최근 1개월" id="monthbtn">
                                <input type="button" name="button" value="최근 3개월" id="three_monthbtn">
                            </span>
                    </td>
                </tr>
                <tr>
                    <th>주문상태</th>
                    <td>
                        <span><input type="checkbox" name="order_state" value="결제완료" id="OL_check_1"><label for="OL_check_1">결제완료</label></span>
                        <span><input type="checkbox" name="order_state" value="배송준비중"  id="OL_check_2"><label for="OL_check_2">배송준비중</label></span>
                        <span><input type="checkbox" name="order_state" value="배송중"  id="OL_check_3"><label for="OL_check_3">배송중</label></span>
                        <span><input type="checkbox" name="order_state" value="배송완료"  id="OL_check_4"><label for="OL_check_4">배송완료</label></span>
                        <span><input type="checkbox" name="order_state" value="주문취소"  id="OL_check_5"><label for="OL_check_5">주문취소</label></span>
                    </td>
                </tr>
                <tr>
                    <th>검색어</th>
                    <td>
                        <select style="width: 155px; padding-left: 10px;">
                            <option value="회원">회원</option>
                            <option value="비회원">비회원</option>
                        </select>
                        <input type="text" name="text" placeholder="주문번호를 입력하세요">
                    </td>
                </tr>
            </table>
            <!--table 끝-->
            <!--OL_c1_btnBox 시작-->
            <div class="bottom_btn" id="OL_c1_btnBox">
                <span><input type="reset" name="reset" value="초기화"></span>
                <span><input type="submit" name="submit" value="검색" id="schbtn"></span>
            </div>
            <!--OL_c1_btnBox 끝-->
        </form>
        <!--form 끝-->
    </div>
    <!--OL_c1 끝-->
    <!--OL_c2 시작-->
    <div class="OL_c2">
        <!--OL_c2_title 시작-->
        <div id="OL_c2_title" class="green_title">
            <p>주문 목록</p>
        </div>
        <!--OL_c2_title 끝-->
        <!--form 시작-->
        <form name="order_list">
                <span>
                    <input type="button" name="button" value="선택삭제" id="delbtn">
                </span>
            <!--table 시작-->
            <table width="100%" class="list_table">
                <tr>
                    <th width="5%"><input type="checkbox" value="cou_list" id="OL_check" name="selectall" onclick="OL_selectAll(this)"><label for="OL_check"></th>
                    <th width="14%">구매자</th>
                    <th width="10%">회원여부</th>
                    <th width="22%">주문정보</th>
                    <th width="14%">결제금액</th>
                    <th width="20%">구매일자</th>
                    <th width="15%">주문상태</th>
                </tr>
                <tr>
                    <td><input type="checkbox" value="cou_list" id="OL_check_7" name="order" onclick="OL_checkSelectAll()"><label for="OL_check_7"></td>
                    <td>예시</td>
                    <td>예시</td>
                    <td>예시</td>
                    <td>예시</td>
                    <td>예시</td>
                    <td>예시</td>
                </tr>
            </table>
            <!--table 끝-->
            <!-- pageBox 시작-->
            <div class="pageBox">
                <ul>
                    <li id="Maxprev"><a href="#"><<</a></li>
                    <li><a href="#"><</a></li>
                    <li><a href="#">1</a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">></a></li>
                    <li id="Maxnext"><a href="#">>></a></li>
                </ul>
            </div>
            <!-- pageBox 끝-->
        </form>
        <!--form 끝-->
    </div>
    <!--OL_c2 끝-->
</div>
<!--Order_list 끝-->
</body>
</html>